---
marp: true
theme: border
paginate: true
header: "ğŸ´ MSU OpSys"
# footer: "What is an OS Really Doing (scaffolding with OpenAI GPT-5)"
# style: ../assets/msu-theme.css
style:
  section {
    font-size: 0.8em; /* shrink all slide text slightly */
  }
  pre code {
    font-size: 0.6em;
  }
---

# ğŸ§© **5. Modern Evolution: RAM Disks, Containers, Virtual Block Devices & Distributed Storage**

---

## âš™ï¸ **Why Memory & Storage Look Very Different Today**

Traditional OS textbooks assume:

- spinning disks
- minimal caching
- simple partitions
- monolithic filesystems
- clear separation between RAM and disk

Modern systems?  
A _riot_ of layers:

- container overlays
- virtual block devices
- RAM-backed filesystems
- SSD firmware mapping
- encrypted volumes
- cloud object stores
- layered caching
- snapshotting & copy-on-write

> **The â€œfilesystemâ€ is no longer just a neat little tree â€” itâ€™s a stack of illusions.**

---

# ğŸ§© **1. RAM Disks / tmpfs**

_(When the OS pretends RAM is a drive)_

---

## âš¡ **RAM Disks: Why They Exist**

- Insanely fast temporary storage
- Skip SSD/HDD entirely
- Perfect for caching, builds, and scratch space
- Used by Linux (`/dev/shm`, `/run`, `/tmp` often tmpfs)

Typical usage:

```
mkdir /mnt/ramdisk
sudo mount -t tmpfs -o size=1G tmpfs /mnt/ramdisk
```

Everything stored here:

- evaporates at reboot
- is limited only by available RAM
- behaves like a real filesystem

> **Analogy:** RAM disk = a whiteboard. Fast to write on, but donâ€™t store your dissertation on it.

---

# ğŸ§© **2. Virtual Block Devices**

_(When storage exists only because software says it does)_

---

## ğŸ“¦ **Loop Devices**

Mount a file as if it were a disk:

```
mount -o loop disk.img /mnt
```

Used for:

- ISO files
- VM images
- container base layers
- disk encryption layers

---

## ğŸ” **Encrypted Block Devices (LUKS, BitLocker, FileVault)**

Data stored on disk is encrypted transparently.

Pipeline:

```
Your writes
  â†“
dm-crypt
  â†“
block device
  â†“
SSD/HDD
```

You get full FS semantics with encryption baked underneath.

---

## ğŸŒ€ **LVM (Logical Volume Manager)**

Lets you:

- resize volumes live
- take snapshots
- stripe across physical disks
- create pools for VMs/containers

> **Think: software-defined storage before it was cool.**

---

# ğŸ§© **3. Overlay File Systems & Containers**

_(Docker magic explained in 90 seconds)_

---

## ğŸ“‚ **The OverlayFS Idea**

Containers need:

- shared read-only base layers (the â€œimageâ€)
- individual writable layers (per container)
- minimal storage footprint
- copy-on-write efficiency

OverlayFS stack:

```
lowerdir: base image (read-only)
upperdir: container writes
merged:   what the container sees
```

When a file changes:

- read from lower if not modified
- copy it to upperdir when written
- upperdir overrides lowerdir
- delete = â€œwhiteoutâ€ file

> **Docker images are basically layer cakes with copy-on-write frosting.**

---

## ğŸ³ **Docker Example (Concept Only)**

Image layers:

```
ubuntu:latest
    â†“
apt install python
    â†“
pip install flask
    â†“
your code
```

At runtime, container sees a merged view of all these layers.

This explains:

- why image size can explode
- why container â€œwritesâ€ arenâ€™t permanent
- why restoring a container is instant â€” just rebuild the layer stack

---

# ğŸ§© **4. Virtual Machines & Their Storage**

_(The matrix inside the matrix)_

---

## ğŸ’½ **VM Disk Images (qcow2, vmdk, vhdx)**

These are:

- sparse files
- dynamically growing
- include metadata
- support snapshots
- often compressed or deduplicated

Inside a VM:

```
Guest OS â†’ Virtual disk driver â†’ Host filesystem â†’ Host block device â†’ SSD firmware
```

So yes â€” your VMâ€™s â€œdisk blocksâ€ may be blocks inside blocks inside blocks.

> **Itâ€™s turtles all the way down.**

---

## ğŸ§® **Copy-on-Write VM Disks**

qcow2 supports:

- snapshots
- layering (like Docker but lower-level)
- branching file versions
- fast clones

Great for:

- class labs
- security sandboxes
- cloud VM provisioning

---

# ğŸ§© **5. Distributed & Cloud File Systems**

_(Your â€œfileâ€ might not even be on your computer)_

---

## ğŸŒ©ï¸ **Object Storage (S3, Blob Storage, MinIO)**

You write _objects_ with keys, not files with paths.

- no directories (just prefixes that look like them)
- automatically replicated
- versioned
- eventually consistent
- accessed via HTTP

> **Your file isnâ€™t stored â€œsomewhereâ€ â€” itâ€™s stored _everywhere_.**

---

## ğŸ§ª **Distributed File Systems (concept only)**

Examples:

- **NFS** â€“ old but everywhere
- **CephFS** â€“ metadata server + object backend
- **GlusterFS** â€“ brick-based replication
- **HDFS** â€“ big-data-oriented block FS

Characteristics:

- nodes fail constantly
- replication replaces reliability
- many are optimized for large sequential reads
- consistency models vary

---

## ğŸ§¬ **Data Deduplication (ZFS, APFS, Btrfs)**

Modern FS maintain:

- block-level checksums
- per-block deduplication
- snapshots and clones
- copy-on-write trees

Snapshot example:

```
btrfs subvolume snapshot ~/data ~/data_backup
```

Instant. No copying.

---

# ğŸ§ª **Real-World Mapping: The Storage Stack Today**

Hereâ€™s a typical containerized, encrypted, cloud-hosted applicationâ€™s storage path:

```
Your program
   â†“
FUSE client (optional)
   â†“
OverlayFS (container writable layer)
   â†“
loop-mounted disk.img (virtual block device)
   â†“
dm-crypt (encryption)
   â†“
LVM thin pool
   â†“
ext4 / xfs / btrfs
   â†“
NVMe SSD firmware (FTL)
   â†“
flash cells
   â†“
cloud block storage replication
```

Good luck debugging performance.

> **Modern storage isnâ€™t a â€œstackâ€ â€” itâ€™s a lasagna.**

---

# ğŸ“¢ **Topic 5 Summary Slide**

- RAM disks give you ultra-fast temporary storage
- Virtual block devices let files behave like disks
- Encryption layers insert themselves transparently
- Containers rely on copy-on-write overlays
- VM disks are layered, sparse, and snapshot-friendly
- Distributed FS introduce replication, consistency, object semantics
- Modern storage = abstraction on abstraction on abstraction

> **â€œThe OS no longer just organizes files.  
> It mediates illusions.â€**
